<div class="invoice-create-container">
  <div class="header">
    <h2>üìÑ Cr√©er une nouvelle facture</h2>
    <div class="steps-indicator">
      <div
        class="step"
        [class.active]="currentStep >= 1"
        [class.completed]="currentStep > 1"
      >
        <span class="step-number">1</span>
        <span class="step-label">Client</span>
      </div>
      <div
        class="step"
        [class.active]="currentStep >= 2"
        [class.completed]="currentStep > 2"
      >
        <span class="step-number">2</span>
        <span class="step-label">Articles</span>
      </div>
      <div class="step" [class.active]="currentStep >= 3">
        <span class="step-number">3</span>
        <span class="step-label">R√©sum√©</span>
      </div>
    </div>
  </div>

  <form [formGroup]="invoiceForm" (ngSubmit)="onSubmit()">
    <!-- √âtape 1: S√©lection du client -->
    <div class="step-content" *ngIf="currentStep === 1">
      <h3>Informations client</h3>

      <div class="form-group">
        <label for="clientId">Client *</label>
        <!--<p>Debug: {{ clients.length }} clients trouv√©s</p>-->
        <select id="clientId" formControlName="clientId" class="form-control">
          <option value="">S√©lectionner un client</option>
          <option *ngFor="let client of clients" [value]="client.id">
            {{ client.nom }} - {{ client.contact }}
          </option>
        </select>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="numero">Num√©ro de facture *</label>
          <input
            id="numero"
            type="text"
            formControlName="numero"
            class="form-control"
            [placeholder]="generateInvoiceNumber()"
            readonly
          />
          <small class="form-text"
            >G√©n√©r√© automatiquement selon le client s√©lectionn√©</small
          >
        </div>

        <div class="form-group">
          <label for="dateEmission">Date d'√©mission *</label>
          <input
            id="dateEmission"
            type="date"
            formControlName="dateEmission"
            class="form-control"
          />
        </div>

        <div class="form-group">
          <label for="dateEcheance">Date d'√©ch√©ance *</label>
          <input
            id="dateEcheance"
            type="date"
            formControlName="dateEcheance"
            class="form-control"
          />
        </div>
      </div>
    </div>

    <!-- √âtape 2: Articles -->
    <div class="step-content" *ngIf="currentStep === 2">
      <h3>Articles et services</h3>

      <div class="articles-section">
        <label id="category-radio-group-label">Cat√©gorie :</label>
        <mat-radio-group
          aria-labelledby="category-radio-group-label"
          class="category-radio-group"
          formControlName="category"
        >
          <mat-radio-button 
            class="category-radio-button" 
            *ngFor="let category of categories" 
            [value]="category"
          >
            {{ category }}
          </mat-radio-button>
        </mat-radio-group>

        <p>Cat√©gorie s√©lectionn√©e: {{ invoiceForm.get('category')?.value }}</p>
        <p>Section des articles √† impl√©menter...</p>
        <p>
          Ici vous pourrez ajouter des produits/services avec quantit√©s et prix.
        </p>
      </div>
    </div>

    <!-- √âtape 3: R√©sum√© -->
    <div class="step-content" *ngIf="currentStep === 3">
      <h3>R√©sum√© de la facture</h3>

      <div class="summary-section">
        <div class="form-group">
          <label for="notes">Notes suppl√©mentaires</label>
          <textarea
            id="notes"
            formControlName="notes"
            class="form-control"
            rows="4"
            placeholder="Merci pour votre confiance..."
          ></textarea>
        </div>

        <div class="invoice-preview">
          <h4>Aper√ßu</h4>
          <p><strong>Client:</strong> {{ getSelectedClientName() }}</p>
          <p><strong>Num√©ro:</strong> {{ invoiceForm.get("numero")?.value }}</p>
          <p>
            <strong>Date d'√©mission:</strong>
            {{ invoiceForm.get("dateEmission")?.value }}
          </p>
          <p>
            <strong>Date d'√©ch√©ance:</strong>
            {{ invoiceForm.get("dateEcheance")?.value }}
          </p>
        </div>
      </div>
    </div>

    <!-- Navigation -->
    <div class="navigation-buttons">
      <button
        type="button"
        class="btn-secondary"
        (click)="previousStep()"
        [disabled]="currentStep === 1"
      >
        ‚Üê Pr√©c√©dent
      </button>

      <button
        type="button"
        class="btn-primary"
        (click)="nextStep()"
        [disabled]="!canProceedToNextStep()"
        *ngIf="currentStep < totalSteps"
      >
        Suivant ‚Üí
      </button>

      <button
        type="submit"
        class="btn-success"
        *ngIf="currentStep === totalSteps"
        [disabled]="!invoiceForm.valid"
      >
        üíæ Cr√©er la facture
      </button>
    </div>
  </form>
</div>
